String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};class MltAutoComplete{constructor(e,t){this.ele=e,this.options=t,this.lastLeadId=0,this.init()}init(){var e=document.querySelector("#"+this.ele);this.createSuggestionNode(),""!=e.value&&(e.dataset.text=e.value)}createSuggestionNode(){var e=this,r=document.querySelector("#"+this.ele),t=document.createElement("ul"),i=r.nextSibling;"label"==(i="#text"==i.nodeName?i.nextSibling:i).tagName.toLowerCase()&&(i=i.nextSibling),t.setAttribute("id",r.getAttribute("id")+"-suggestion"),t.setAttribute("class","suggestion-box"),t.classList.add("hide"),r.parentNode.insertBefore(t,i),r.addEventListener("focus",function(){e.setSuggestion(this.value)}),r.addEventListener("input",function(){e.setSuggestion(this.value)}),r.addEventListener("click",function(){this.setSelectionRange(0,this.value.length),e.setSuggestion("")}),document.addEventListener("click",e=>{var t=document.querySelector("#"+this.ele+"-suggestion"),i=r;let a=e.target;do{if(a==t||a==i)return}while(a=a.parentNode);r.value="",r.dataset.text&&(r.value=r.dataset.text),null!==t&&(t.innerHTML="",t.classList.add("hide"))})}setSuggestion(i){var a=this,r=void 0!==this.options.key?this.options.key:"value",s=void 0!==this.options.text?this.options.text:"text",o=document.querySelector("#"+this.ele),l=document.querySelector("#"+o.getAttribute("id")+"-suggestion");l.innerHTML="",this.options.choices.forEach(e=>{var t;""!=i&&-1===e[s].toLowerCase().indexOf(i.toLowerCase())||((t=document.createElement("li")).dataset.val=e[r],t.dataset.text=e[s],t.innerHTML=e[s],l.appendChild(t),l.classList.remove("hide"),"boolean"!=typeof e.header?t.addEventListener("click",function(){a.onSelect(this.dataset.val),l.innerHTML="",o.value=this.dataset.text,o.dataset.text=this.dataset.text}):(t.classList.add("suggestion-header"),t.addEventListener("click",function(){})))})}setValue(e){document.querySelector("#"+this.ele).dataset.text=e,document.querySelector("#"+this.ele).value=e}onSelect(e){"function"==typeof this.options.onSelect&&this.options.onSelect(e)}open(){this.setSuggestion("")}}class MltCountDown{constructor(){this.status=!1,this.element=null,this.handler=null}init(e,t,i){this.status=!0,this.element=e,this.handler=t,this.run(i)}stop(){this.status=!1}run(e){this.element.innerHTML=e,e=--e,setTimeout(()=>{0<e&&this.status?this.run(e):0==e&&"function"==typeof this.handler&&this.handler()},1e3)}stop(){this.status=0}}class CustomSelect{constructor(e){this.init(e)}init(e){document.querySelectorAll(e).forEach(o=>{var l=o.querySelector("select"),n="Y"==o.getAttribute("data-init");"ajax"!=l.getAttribute("data-type")||l.hasAttribute("data-refreshon")?this.setInput(o,l,n):fetch(l.dataset.url,{method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{var t,i=e[l.dataset.index]||e,a='<option value="">'+l.querySelector("option").innerHTML+"</option>";for(t in i){var r,s=l.dataset.template;for(r in s=(s=s.split("\\")).join(""),i[t])s=s.replace("{{item."+r+"}}",i[t][r]);a+=s}l.innerHTML=a,this.setInput(o,l,n)})}),document.querySelector("body").addEventListener("click",()=>{this.closeAllSelect()})}setInput(e,a,t){if(!0!==t)e.setAttribute("data-init","Y"),(r=document.createElement("DIV")).setAttribute("class","select-selected"),r.innerHTML=a.options[a.selectedIndex].innerHTML,e.appendChild(r),(s=document.createElement("DIV")).setAttribute("class","select-items select-hide");else for(var r=e.querySelector(".select-selected"),s=e.querySelector(".select-items");s.firstChild;)s.removeChild(s.firstChild);a.querySelectorAll("option").forEach((e,t)=>{var i=document.createElement("DIV");i.innerHTML=e.innerHTML,i.addEventListener("click",()=>{a.selectedIndex=t,r.innerHTML=i.innerHTML,a.dispatchEvent(new Event("change")),this.closeAllSelect(r),setTimeout(()=>{this.setSelected(a.querySelectorAll("option"),e)},50)}),s.appendChild(i)}),!0!==t&&(e.appendChild(s),r.addEventListener("click",e=>{e.stopPropagation(),this.closeAllSelect(),r.nextSibling.classList.toggle("select-hide"),r.classList.toggle("select-arrow-active")}))}closeAllSelect(){document.querySelectorAll(".select-items").forEach(e=>{e.classList.add("select-hide")}),document.querySelectorAll(".select-selected").forEach(e=>{e.classList.remove("select-arrow-active")})}setSelected(e,t){e.forEach(e=>{e.removeAttribute("selected")}),t.setAttribute("selected","selected")}}class MltLeadFormClass{constructor(e,t,i){this.countDown=new MltCountDown,this.message="",this.helper=i,this.storageFactory=t,this.businessUnit=e.businessUnit||this.helper.getBusinessUnit(),this.cities=[],this.autoComp,this.autoCompOverseas,this.lead={},this.ajaxVerification=!1,this.checkingOtp=!1,this.lang_code=e.lang_code||this.helper.getLangCode(),this.overseasform=!1,this.gtmTracking=!0,this.otpScreen=1,this.otpHandler=null,this.init(e)}addLoader(){var e=document.createElement("div");e.setAttribute("id","overlay-loader"),e.setAttribute("class","overlay_loader loader"),e.innerHTML='<div class="loader"><div></div><div></div><div></div><div></div></div>',document.querySelector("body").appendChild(e)}removeLoader(){var e=document.querySelector("#overlay-loader");null!=e&&e.parentNode.removeChild(e)}hide(e){document.querySelectorAll(e).forEach(e=>{e.classList.add("hidden"),e.classList.remove("transition")})}show(e){document.querySelectorAll(e).forEach(e=>{e.classList.remove("hidden"),e.classList.add("transition")})}getConnectoId(){return"undefined"!=typeof _connecto&&"function"==typeof _connecto.getIdentity?_connecto.getIdentity():""}getBtnType(e){var t={70:"Lead Button",13:"Call Now",1:"Direct Call",2:"Lead Form Call"};return void 0===t[e]?"":t[e]}createUrl(i,e){if(i=this.helper.getEnquiryUrl()+i+"?country_code="+this.helper.getCountryCode()+"&lang_code="+this.helper.getLangCode()+"&business_unit="+this.businessUnit,void 0!==e&&"null"!=typeof e)for(var[a,t]of Object.entries(e))if("object"==typeof t&&null!==t)for(var[r,s]of Object.entries(t))if("object"==typeof s)for(let[e,t]of Object.entries(s))i+="&"+a+"["+r+"]["+e+"]="+t;else i+="&"+a+"["+r+"]="+value3;else i+="&"+a+"="+t;return i}setValue(e,t){document.querySelectorAll(e).forEach(e=>{e.dataset.text=t,e.value=t})}getValue(e){e=document.querySelector(e);return null!=e?e.value:""}decodeURL(t){try{return t=t.split("+").join(" "),JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}catch(e){var i={};return t.split("&").forEach(e=>{e=e.split("=");i[e[0]]=e[1]}),i}}otpShow(){this.show("#mlt__step-otp"),this.hide("#mlt__step-otp #otp__error"),document.querySelector("#mlt__step-otp #otp__error").innerHTML="","wap"==this.getValue("#mltlead-platform")?document.querySelector("#mlt__step-otp .card-curved").classList.add("transition","slide-up"):this.hide("#multisteps__form, #mltstep__lead #heading__step-2"),"web"==this.getValue("#mltlead-platform")&&this.hide("#mltstep__lead, #mltstep__cross-sell")}otpHide(){this.hide("#mlt__step-otp"),"wap"==this.getValue("#mltlead-platform")?document.querySelector("#mlt__step-otp .card-curved").classList.remove("transition","slide-up"):this.show("#multisteps__form, #mltstep__lead #heading__step-2"),"web"==this.getValue("#mltlead-platform")&&(2==this.otpScreen?this.show("#mltstep__cross-sell"):this.show("#mltstep__lead")),this.countDown.stop()}removeAll(e){"string"==typeof e?document.querySelectorAll(e).forEach(e=>{e.remove()}):"object"==typeof e&&e.forEach(e=>{e.remove()})}autoTextarea(e){document.querySelectorAll(e).forEach(t=>{t.classList.contains("mlt_txtareauto")||(t.classList.add("mlt_txtareauto"),t.addEventListener("input",e=>{t.style.height="auto",t.style.height=t.scrollHeight+"px"}))})}tracking(r,s,o){if(!1===this.gtmTracking)return this.gtmTracking;setTimeout(()=>{var e=70,t="dcb",i=1==this.getValue("#mltlead-is_overseas")?"Yes":"No",a=(void 0===o&&(o=""),""!=this.getValue("#mltlead-lead_type")&&(e=this.getValue("#mltlead-lead_type")),""!=this.getValue("#mltlead-webid")&&(t=this.getValue("#mltlead-webid")),3==this.getValue("#mltlead-button_type")&&(a="-WA Offer","brochure"==this.getValue("#mltlead-wa_type")?a="-WA Brochure":"dealer"==this.getValue("#mltlead-wa_type")&&(a="-WA Dealer"),r+=a),{event:"MLTLeadForm",stepnumber:s,stepname:r,label:o,leadlocation:this.getValue("#mltlead-leadform_location"),leadtype:e,Leadfor:t,Oem_name:this.getValue("#mltlead-brand"),Model_name:this.getValue("#mltlead-model"),Leadvariantname:this.getValue("#mltlead-variant"),Vehicletype:this.getValue("#mltlead-category_slug"),Vehicle_segment:this.getValue("#mltlead-body_type"),button_type:this.getBtnType(this.getValue("#mltlead-button_type")),page_type:this.getValue("#mltlead-pagetype"),template_type_new:this.getValue("#mltlead-template_type_new"),ofw:i,phone_number:this.getValue("#mltlead-mobile")});window.dataLayer.push(a)},20)}trackingConfirm(){window.dataLayer.push({event:"LeadConfirm"}),window.dataLayer.push({event:"newcarleadformsubmit",leadlocation:this.getValue("#mltlead-leadform_location"),leadid:this.lead._id,oem_name:this.getValue("#mltlead-brand"),model_name:this.getValue("#mltlead-brand")+" "+this.getValue("#mltlead-model"),leadvariantname:this.getValue("#mltlead-variant_slug"),vehicle_segment:this.getValue("#mltlead-body_type"),leadtype:70,lead_city:this.getValue("#mltlead-city_name"),page_type:this.getValue("#mltlead-pagetype"),phone_number:this.getValue("#mltlead-mobile")}),"facebook"==this.storageFactory.getUtmSource()&&this.metaConversion()}metaConversion(){var e=new FormData;e.append("leadlocation",this.getValue("#mltlead-leadform_location")),e.append("leadid",this.lead._id),e.append("oem_name",this.getValue("#mltlead-brand")),e.append("model_name",this.getValue("#mltlead-brand")+" "+this.getValue("#mltlead-model")),e.append("leadvariantname",this.getValue("#mltlead-variant_slug")),e.append("vehicle_segment",this.getValue("#mltlead-body_type")),e.append("leadtype",70),e.append("lead_city",this.getValue("#mltlead-city_name")),e.append("page_type",this.getValue("#mltlead-pagetype")),e.append("phone_number",this.getValue("#mltlead-mobile")),fetch(this.createUrl("/conversion/meta",{eventName:"LeadConversionAPI",domain:this.getValue("#mltlead-domain")}),{method:"post",body:e}).then(e=>e.json()).then(e=>{})}gaTrackingEvent(){document.querySelector("#lead-section").addEventListener("click",e=>{for(var t,i,a=e.target;a&&"function"==typeof a.hasAttribute&&!a.hasAttribute("data-mltga-tracking");)a=a.parentNode;a&&"function"==typeof a.hasAttribute&&a.hasAttribute("data-mltga-tracking")&&(e=a.getAttribute("data-mltga-stepname"),t=a.getAttribute("data-mltga-stepnumber"),i=a.hasAttribute("data-mltga-label")?a.getAttribute("data-mltga-label"):"",this.tracking(e,t,i))})}isIframe(){return null!==window.top.document&&null!==window.top.document.getElementById("lead-iframe")}closeIframe(){this.isIframe()&&setTimeout(function(){window.top.document.getElementById("lead-iframe").parentElement.childNodes[0].click()},50)}goBack(){document.querySelector("#lead-section").addEventListener("click",e=>{"close"==e.target.getAttribute("data-mltclick")?(document.querySelector("#mlt-overlay")&&document.querySelector("#mlt-overlay").remove(),setTimeout(function(){document.querySelector("body").classList.remove("body__overview")},100),1==e.target.dataset.stepnumber&&document.querySelector("#heading__step-1").classList.contains("hidden")?this.tracking("Back Clicked",2):this.tracking("Back Clicked",e.target.dataset.stepnumber),document.querySelector("#lead-section").remove(),this.closeIframe()):"goback"==e.target.getAttribute("data-mltclick")?(1==e.target.dataset.stepnumber&&document.querySelector("#heading__step-1").classList.contains("hidden")?this.tracking("Back Clicked",2):this.tracking("Back Clicked",e.target.dataset.stepnumber),window.history.back()):"editinfo"==e.target.getAttribute("data-mltclick")&&(this.hide(".mlt-maincontainer"),this.show("#mltstep__lead, #mltstep__lead .step-2, #heading__step-2"),setTimeout(()=>{document.querySelector("#mltlead-name").focus()},50))})}callAjaxVerification(e){0==this.ajaxVerification&&(this.ajaxVerification=!0,this.initAjaxVerification(e))}initAjaxVerification(t){var e;document.querySelector("#mlt__step-otp").classList.contains("hidden")?this.ajaxVerification=!1:((e=new FormData).append("mobile",t),fetch(this.createUrl("/sms/is-mobile-verified"),{method:"post",body:e}).then(e=>e.json()).then(e=>{1==e.status&&(this.tracking("Verification Submit Via "+e.via,2),this.otpHide(),this.hide("#mltstep__lead .step-2, #heading__step-2"),1==this.otpScreen?this.firstStep():2==this.otpScreen&&"function"==typeof this.otpHandler&&this.otpHandler()),0==e.status&&setTimeout(()=>{this.initAjaxVerification(t)},3e3)}))}mltOverlay(e){"web"!=e.platform||document.getElementById("mlt-overlay")||((e=document.createElement("div")).setAttribute("id","mlt-overlay"),e.setAttribute("class","overlay"),document.querySelector("body").appendChild(e),document.querySelector("body").classList.add("body__overview"))}async init(t){this.mltOverlay(t),this.addLoader(),"ph"==this.helper.getCountryCode()&&await fetch(this.createUrl("/ajax/geo"),{method:"GET"}).then(e=>e.json()).then(e=>{null!=typeof e.countryCode&&(t.geo_code=e.countryCode,this.storageFactory.setCountry(e.countryName),this.setValue("#mltlead-country",e.countryName))}),fetch(this.createUrl("/multi-step-lead",t),{method:"GET",credentials:"include"}).then(e=>("function"==typeof firstPopupClose&&firstPopupClose(this.mltOverlay,t),e.json())).then(e=>{var t,i;this.removeLoader(),void 0!==e.html&&(this.overseasform=e.isOfwEnabled,i=document.querySelector("body"),null!=(t=document.querySelector("#lead-section"))&&i.removeChild(t),!0===this.isIframe()&&i.classList.add("lead-ifream"),(t=document.createElement("div")).innerHTML=e.html,t.setAttribute("id","lead-section"),t.setAttribute("class","modal-popup lead-form clearfix"),document.querySelector("body").appendChild(t),document.querySelector(".dull-overlay")&&(i=document.querySelector(".dull-overlay")).parentNode.removeChild(i),setTimeout(()=>{var e=document.createElement("div");e.setAttribute("class","dull-overlay"),document.querySelector("body").appendChild(e),this.setConditional(document.querySelector("#mltstep__lead")),this.dropDownScroll(document.querySelector("#multisteps__form .step2-a")),document.getElementById("mltlead-city").dispatchEvent(new Event("change")),this.executeScript("#mltstep__lead")},100),this.setFormValue(),this.tracking("Lead Button Click",1),this.setEventTrigger(),this.setSubmit(),this.gaTrackingEvent(),this.goBack(),setTimeout(()=>{var e,t=[this.createUrl("/multistep/src/js/calendar-ui.js")],i=[this.createUrl("/multistep/src/css/calendar-ui-min.css")];null==document.querySelector('script[src*="jquery-3.6.0.min.js"]')&&((e=document.createElement("script")).setAttribute("type","text/javascript"),e.setAttribute("defer","defer"),e.setAttribute("src",this.createUrl("/multistep/src/js/jquery-3.6.0.min.js")),document.querySelector("head").appendChild(e)),t.forEach(e=>{var t;null==document.querySelector('script[src="'+e+'"]')&&((t=document.createElement("script")).setAttribute("type","text/javascript"),t.setAttribute("defer","defer"),t.setAttribute("src",e),document.querySelector("head").appendChild(t))}),i.forEach(e=>{var t;null==document.querySelector('link[href="'+e+'"]')&&((t=document.createElement("link")).setAttribute("rel","stylesheet"),t.setAttribute("href",e),document.querySelector("head").appendChild(t))}),"function"==typeof this.helper.addDependency&&this.helper.addDependency({platform:this.getValue("#mltlead-platform"),webid:this.getValue("#mltlead-webid")})},5e3),this.setCountryList(e.countries),document.querySelector(".mlt__model-autosuggestion"))&&this.setModelSuggestion(e.modelList)})}setCountryList(e){new MltAutoComplete("country__selection",{choices:e,key:"name",text:"name",onSelect:e=>{this.storageFactory.setCountry(e),this.setValue("#mltlead-country",e),this.setIsdField(e),document.querySelector("#country__selection-error").classList.add("hidden")}}).setValue(this.storageFactory.getCountry())}setModelSuggestion(e){new MltAutoComplete("mltlead-model",{choices:e,key:"slug",text:"name",onSelect:e=>{this.setValue("#mltlead-model_slug",e),document.querySelector(".mlt__model-autosuggestion .error")&&(document.querySelector(".mlt__model-autosuggestion .error").innerHTML="")}})}setIsdField(e){e&&(document.querySelector('#mltlead-isd [selected="selected"]')&&(document.querySelector('#mltlead-isd [selected="selected"]').removeAttribute("selected"),document.querySelector('#mltlead-isd_alt [selected="selected"]').removeAttribute("selected")),document.querySelector('#mltlead-isd [data-country="'+e+'"]').setAttribute("selected","selected"),document.querySelector('#mltlead-isd_alt [data-country="'+e+'"]').setAttribute("selected","selected"))}setFormValue(){this.storageFactory.getMobile()&&this.setValue("#mltlead-mobile",this.storageFactory.getMobile()),this.setValue("#mltlead-name",this.storageFactory.getName()),this.setValue("#mltlead-utm_source",this.storageFactory.getUtmSource()),this.setValue("#mltlead-utm_campaign",this.storageFactory.getUtmCampaign()),this.setValue("#mltlead-utm_medium",this.storageFactory.getUtmMedium()),this.setValue("#mltlead-utm_content",this.storageFactory.getUtmContent()),this.setValue("#mltlead-loc_physical_ms",this.storageFactory.getLocPhysicalMs()),this.setValue("#mltlead-utm_term",this.storageFactory.getUtmTerm()),this.setValue("#mltlead-landing_url",decodeURIComponent(this.storageFactory.getLandingUrl())),this.setValue("#mltlead-connecto_id",this.getConnectoId()),this.setValue("#mltlead-country",this.storageFactory.getCountry()),this.setValue("#mltlead-is_overseas",this.storageFactory.getIsOverseasWorker()),"function"==typeof this.storageFactory.getGclid&&this.setValue("#mltlead-gclid",this.storageFactory.getGclid()),this.setCitySuggestion()}setCitySuggestion(){this.addLoader(),fetch(this.createUrl("/ajax/city-list",{businessUnit:this.getValue("#mltlead-category_slug"),domain:this.getValue("#mltlead-domain"),brand:this.getValue("#mltlead-brand_slug"),model:this.getValue("#mltlead-model_slug")}),{method:"GET"}).then(function(e){return e.json()}).then(e=>{this.removeLoader();var r='<legend class="m-sm-b">'+e.popularHeader.text+"</legend>",t=(e.all.forEach(e=>{e={text:e.cityTitle||e.cityName,value:"cityId="+e.cityId+"&cityName="+e.cityName+"&cityTitle="+(e.cityTitle||e.cityName)+"&citySlug="+e.citySlug+"&subCityId="+e.subCityId+"&subCityName="+e.subCityName};this.cities.push(e)}),e.popular.forEach(e=>{var t=e.cityTitle||e.cityName,i="cityId="+e.cityId+"&cityName="+e.cityName+"&cityTitle="+(e.cityTitle||e.cityName)+"&citySlug="+e.citySlug+"&subCityId="+e.subCityId+"&subCityName="+e.subCityName,a=(r+='<label class="chip-control">',"");e.citySlug==this.storageFactory.getCitySlug()&&(a='checked="checked"'),r=(r+='<input type="radio" name="mltSteps_city" '+a+' value="'+i+'" />')+"<span>"+t+"</span></label>"}),0!=e.popular.length&&(document.querySelector("#multistep__popularcity").innerHTML=r,this.show("#multistep__popularcity")),setTimeout(()=>{document.querySelectorAll('#mltstep__lead input[name="mltSteps_city"]').forEach(e=>{e.addEventListener("click",()=>{this.setUserCity(e.value,!1),this.hide("#mltstep__lead .step-1, #heading__step-1, #multisteps__overseas-form"),this.show("#mltstep__lead .step-2, #heading__step-2, #multisteps__form"),this.tracking("Popular City Selected",1),this.tracking("Lead Form Open",2)})})},20),this.autoComp=new MltAutoComplete("city__selection",{choices:this.cities,onSelect:e=>{this.tracking("City Selected",1),e=this.setUserCity(e,!1),this.hide("#mltstep__lead .step-1, #heading__step-1, #multisteps__overseas-form"),this.show("#mltstep__lead .step-2, #heading__step-2, #multisteps__form"),this.tracking("Lead Form Open",2)}}),this.autoCompOverseas=new MltAutoComplete("city__selection-overseas",{choices:this.cities,onSelect:e=>{this.setUserCity(e,!0)}}),this.storageFactory.getCitySlug()),i=!1;t&&this.cities.forEach(e=>{e=this.decodeURL(e.value);t==e.citySlug&&(i=!0,this.autoComp.setValue(e.cityTitle||e.cityName),this.autoCompOverseas.setValue(e.cityTitle||e.cityName),this.setValue("#mltlead-city_name",e.cityTitle||e.cityName),this.setValue("#mltlead-city_id",e.cityId),this.setValue("#mltlead-city",e.citySlug))}),this.openLeadFlow(i)})}openLeadFlow(e){0==this.overseasform&&!e||1==this.overseasform&&(""===this.storageFactory.getIsOverseasWorker()||"1"===this.storageFactory.getIsOverseasWorker()&&""===this.storageFactory.getCountry()||"0"===this.storageFactory.getIsOverseasWorker()&&!e)?this.tracking("Lead Form Open",1):(1==this.storageFactory.getIsOverseasWorker()?(this.show("#multisteps__overseas-form"),this.hide("#multisteps__form")):(this.hide("#multisteps__overseas-form"),this.show("#multisteps__form")),this.hide("#mltstep__lead .step-1, #heading__step-1"),this.show("#mltstep__lead .step-2, #heading__step-2"),this.tracking("Lead Form Open",2)),this.overseasform&&this.overseasFormEvent()}overseasFormEvent(){var e=this.storageFactory.getIsOverseasWorker();this.show("#mlt__ask-oworker"),this.setIsdField(this.storageFactory.getCountry()),document.querySelectorAll('#mlt__ask-oworker input[name="isOverseasWorker"]').forEach(e=>{e.addEventListener("click",()=>{this.storageFactory.setIsOverseasWorker(e.dataset.value),this.setValue("#mltlead-is_overseas",e.dataset.value),"yes"==e.value?(this.show("#mlt__oworker-location, #submit__step1"),this.hide("#mlt__stpe1city, #multistep__popularcity")):(this.hide("#mlt__oworker-location, #submit__step1"),this.show("#mlt__stpe1city, #multistep__popularcity"))})}),1==e?(document.querySelector('#mlt__ask-oworker input[value="yes"]').setAttribute("checked","checked"),document.querySelector('#mlt__ask-oworker input[value="yes"]').dispatchEvent(new Event("click"))):document.querySelector('#mlt__ask-oworker input[value="no"]').setAttribute("checked","checked"),document.querySelector("#mlt__addmore-mobile").addEventListener("click",e=>{e.target.checked?this.show("#mlt__alternate_mobile-box"):this.hide("#mlt__alternate_mobile-box")}),document.querySelector("#submit__step1").addEventListener("click",e=>{""!=document.querySelector("#country__selection").value?(document.querySelector("#country__selection-error").classList.add("hidden"),this.hide("#mltstep__lead .step-1, #heading__step-1, #multisteps__form"),this.show("#mltstep__lead .step-2, #heading__step-2, #multisteps__overseas-form"),this.tracking("Lead Form Open",2)):document.querySelector("#country__selection-error").classList.remove("hidden")})}setUserCity(t,e){return document.querySelectorAll('[name="mltSteps_city"]').forEach(e=>{e.value==t&&(e.checked=!0)}),t=this.decodeURL(t),this.autoComp.setValue(t.cityTitle||t.cityName),this.autoCompOverseas.setValue(t.cityTitle||t.cityName),this.hide("#city__selection-error"),this.setValue("#mltlead-city_name",t.cityTitle||t.cityName),this.setValue("#mltlead-city_id",t.cityId),this.setValue("#mltlead-city",t.citySlug),this.storageFactory.setCity(t.citySlug,t.cityName),this.storageFactory.setCityId(t.cityId),this.updateCta(),this.updateFirstStep(),this.updateBanner(),document.getElementById("mltlead-city").dispatchEvent(new Event("change")),t}updateCta(){var e=document.querySelector("#multisteps__form"),e=new FormData(e);fetch(this.createUrl("/multi-step-lead/cta"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{void 0!==e.step1_h1&&(document.querySelector("#heading__step-1").innerHTML=e.step1_h1),void 0!==e.step2_h1&&(document.querySelector("#heading__step-2").innerHTML=e.step2_h1),void 0!==e.step2_h2&&(document.querySelector("#subheading__step-2").innerHTML=e.step2_h2),void 0!==e.step2_cta&&(void 0!==e.button_type&&3==e.button_type&&(e.step2_cta=' <i class="ic-whatsapp m-sm-r"></i> '+e.step2_cta),document.querySelector("#submit__step2").innerHTML=e.step2_cta),void 0!==e.name_cta&&document.querySelector("#multisteps__form #mltlead-name").parentNode.querySelector("label").setAttribute("data-label",e.name_cta),void 0!==e.mobile_cta&&document.querySelector("#multisteps__form #mltlead-mobile").parentNode.querySelector("label").setAttribute("data-label",e.mobile_cta),void 0!==e.overseas_name_cta&&document.querySelector("#multisteps__overseas-form #mltlead-name").parentNode.querySelector("label").setAttribute("data-label",e.overseas_name_cta),void 0!==e.overseas_mobile_cta&&document.querySelector("#multisteps__overseas-form #mltlead-mobile").parentNode.querySelector("label").setAttribute("data-label",e.overseas_mobile_cta)})}updateFirstStep(){var e=document.querySelector("#multisteps__form"),e=new FormData(e);fetch(this.createUrl("/multi-step-lead/first-step"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{void 0!==e.html?(document.querySelector("#mlt__first-step").innerHTML=e.html,this.setConditional(document.querySelector("#mltstep__lead")),this.dropDownScroll(document.querySelector("#multisteps__form .step2-a")),document.getElementById("mltlead-city").dispatchEvent(new Event("change")),setTimeout(()=>{this.executeScript("#mlt__first-step")},100)):document.querySelector("#mlt__first-step").innerHTML=""})}dropDownScroll(t){setTimeout(()=>{t.querySelectorAll(".custom-select .select-selected").forEach(e=>{e.addEventListener("click",()=>{if(t.querySelector("form")&&"wap"==this.getValue("#mltlead-platform"))t.querySelector("form").scrollIntoView();else if("wap"==this.getValue("#mltlead-platform")){t.classList.add("step2Elm");let i=[];t.querySelectorAll("fieldset").forEach(e=>{e.parentNode.classList.contains("step2Elm")&&i.push(e)}),i.forEach((e,t)=>{t==i.length-1&&e.scrollIntoView()})}else t.scrollTo({top:e.offsetTop+225,behavior:"smooth"})})})},50)}updateBanner(){var e=document.querySelector("#multisteps__form"),e=new FormData(e);fetch(this.createUrl("/multi-step-lead/banner"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{"web"==this.getValue("#mltlead-platform")&&void 0!==e.banner&&(document.querySelector("#mlt__web-banner").innerHTML=e.banner)})}startCountDown(e){document.querySelector("#otp__countDown").parentNode.classList.remove("hidden"),this.hide("#resend__otp, #mlt__verify-via-missCall, #mlt__verify-via-whatsApp, #mlt__verify-via-viber"),this.countDown.init(document.querySelector("#otp__countDown"),()=>{document.querySelector("#otp__countDown").parentNode.classList.add("hidden"),4!=this.lead.otp.resend_otp_via&&this.show("#resend__otp"),this.lead.otp.is_misscall_verify&&"web"!=this.lead.platform&&(document.querySelector("#mlt__verify-via-missCall").setAttribute("href","tel:"+this.lead.otp.misscall_no),this.show("#mlt__verify-via-missCall"),this.tracking("MissCall Verification Appear",2)),this.lead.otp.is_whatsapp_verify&&"F"==document.querySelector("#mlt__verify-via-whatsApp").getAttribute("data-clicked")&&(this.show("#mlt__verify-via-whatsApp"),this.tracking("Whatsapp OTP Appear",2)),this.lead.otp.is_viber_verify&&"F"==document.querySelector("#mlt__verify-via-viber").getAttribute("data-clicked")&&(this.show("#mlt__verify-via-viber"),this.tracking("Viber OTP Appear",2)),"function"==typeof e&&e()},30)}setEventTrigger(){document.querySelector("#city__selection").addEventListener("focus",()=>{this.tracking("City Searched",1)});var e=document.querySelectorAll('#multisteps__form input[type="text"], #multisteps__form input[type="tel"], #multisteps__form input[type="checkbox"], #multisteps__form input[type="radio"], #multisteps__form select');let t=["keyup","change","paste","blur"];e.forEach(i=>{t.forEach(t=>{i.addEventListener(t,e=>{i.parentNode.querySelector("span.error")&&i.parentNode.querySelector("span.error").remove(),"blur"!=t||""==e.target.value||"mltlead-name"!=e.target.getAttribute("id")&&"mltlead-mobile"!=e.target.getAttribute("id")||("mltlead-name"==e.target.getAttribute("id")?this.tracking("Name Filled",2):this.tracking("Mobile Filled",2))})})}),document.querySelector("#lead-section").addEventListener("click",e=>{var t;e.target.classList.contains("edit-city")?(this.hide(".mlt-maincontainer, #mltstep__lead .step-2, #heading__step-2"),this.show("#mltstep__lead .step-1, #heading__step-1, #mltstep__lead"),this.tracking("City Edit Clicked",e.target.dataset.stepnumber)):e.target.classList.contains("edit-info")?(this.hide(".mlt-maincontainer, #mltstep__lead .step-1, #heading__step-1"),this.show("#mltstep__lead .step-2, #mltstep__lead, #heading__step-2"),this.tracking("Details Edit Clicked",e.target.dataset.stepnumber)):e.target.classList.contains("edit-vechile-detail")?(this.hide(".mlt-maincontainer, #mltstep__lead .step-2"),this.show("#vechile-info, #mltstep__lead"),(t=document.querySelector("#ybmv__vechile-select")).classList.remove("hidden"),t.classList.add("transition"),t.querySelector(".card-curved").classList.add("transition","slide-up"),this.tracking("Vechile Details Edit Clicked",e.target.dataset.stepnumber)):e.target.classList.contains("edit-exchange-vechile-detail")?(this.hide(".mlt-maincontainer, #mltstep__lead .step-2"),this.show("#exchange-vechile-info, #mltstep__lead"),(t=document.querySelector("#ybmv__exchange-vechile-select")).classList.remove("hidden"),t.classList.add("transition"),t.querySelector(".card-curved").classList.add("transition","slide-up"),this.tracking("Vechile Details Edit Clicked",e.target.dataset.stepnumber)):e.target.classList.contains("edit-preferred-vechile-detail")&&(this.hide(".mlt-maincontainer, #mltstep__lead .step-2"),this.show("#exchange-vechile-info, #mltstep__lead"),(t=document.querySelector("#ybmv__preferred-vechile-select")).classList.remove("hidden"),t.classList.add("transition"),t.querySelector(".card-curved").classList.add("transition","slide-up"),this.tracking("Vechile Details Edit Clicked",e.target.dataset.stepnumber))}),null!=document.querySelector("#ybmv__vechile-select")&&document.querySelector("#ybmv__vechile-select").addEventListener("click",e=>{e.target.classList.contains("close-step-brand")&&(this.show(".mlt-maincontainer, #mltstep__lead .step-2"),this.hide("#vechile-info"))}),null!=document.querySelector("#ybmv__exchange-vechile-select")&&document.querySelectorAll("#ybmv__exchange-vechile-select, #ybmv__preferred-vechile-select").forEach(e=>{e.addEventListener("click",e=>{e.target.classList.contains("close-step-brand")&&(this.show(".mlt-maincontainer, #mltstep__lead .step-2"),this.hide("#exchange-vechile-info"))})}),document.querySelectorAll("#mlt__step-otp #edit-mobile, #mlt__third-party-otp #edit-third-party-mobile").forEach(e=>{e.addEventListener("click",()=>{this.otpHide(),this.thirdPartyOtpHide(),this.tracking("Edit Mobile Number Clicked",2),document.querySelector("#mlt__verify-via-whatsApp").dataset.clicked="F",document.querySelector("#mlt__verify-via-viber").dataset.clicked="F",setTimeout(()=>{document.querySelector("#mltlead-mobile").focus()},50)})});var a=document.querySelectorAll('#mlt__step-otp input[name="otp[]"]'),s=(document.querySelector("#resend__otp").addEventListener("click",()=>{this.addLoader(),this.countDown.stop(),this.hide("#mlt__step-otp #otp__error"),document.querySelector("#mlt__step-otp #otp__error").innerHTML="",a.forEach(e=>{e.value=""}),this.tracking("Resend OTP Clicked",2);var e=new FormData;e.append("mobile",this.lead.mobile),e.append("resend_otp_via",this.lead.otp.resend_otp_via),e.append("name",this.lead.name),e.append("domain",this.lead.domain),fetch(this.createUrl("/sms/resend-otp"),{method:"post",body:e}).then(e=>e.json()).then(e=>{this.removeLoader(),this.startCountDown(),e.resendVia&&([1,2,3].includes(this.lead.otp.resend_otp_via)&&this.autoDetectOtp(),document.querySelector("#mlt__step-otp #otp-message").innerHTML=e.resendVia)})}),document.querySelectorAll('#mlt__third-party-otp input[name="otp[]"]'));document.querySelector("#resend__third-party-otp").addEventListener("click",()=>{this.countDown.stop(),this.hide("#mlt__third-party-otp #otp__third-party-error"),document.querySelector("#mlt__third-party-otp #otp__third-party-error").innerHTML="",s.forEach(e=>{e.value=""}),this.tracking("Resend OTP Clicked",2);var e=new FormData;e.append("businessUnit",this.lead.category_slug),e.append("_id",this.lead._id),e.append("mobile",this.lead.mobile),e.append("factory",this.lead.thirdPartyOtp.factory),e.append("trigger",this.lead.thirdPartyOtp.trigger),this.addLoader(),fetch(this.createUrl("/sms/resend-otp-via-third-party"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{this.removeLoader(),this.startThirdPartyCountDown()})}),s.forEach(r=>{r.addEventListener("keyup",e=>{var t="";if(this.hide("#mlt__third-party-otp #otp__third-party-error"),(document.querySelector("#mlt__third-party-otp #otp__third-party-error").innerHTML="")!=r.value&&("INPUT"==r.nextSibling.nodeName&&r.nextSibling.focus(),s.forEach(e=>{t+=e.value}),6==t.length)&&0==this.checkingOtp){this.checkingOtp=!0,this.addLoader(),this.tracking("Verification Submit",2);var i,a=new FormData;for(i in a.append("businessUnit",this.lead.category_slug),a.append("_id",this.lead._id),a.append("mobile",this.lead.mobile),a.append("factory",this.lead.thirdPartyOtp.factory),a.append("trigger",this.lead.thirdPartyOtp.trigger),a.append("otp",t),this.lead.thirdPartyOtp.data)a.append(i,this.lead.thirdPartyOtp.data[i]);fetch(this.createUrl("/sms/verify-otp-via-third-party"),{method:"POST",body:a,credentials:"include"}).then(e=>e.json()).then(e=>{this.checkingOtp=!1,this.removeLoader(),1==e.status?(this.thirdPartyOtpHide(),this.hide("#mltstep__lead .step-2, #heading__step-2"),this.firstStep()):0==e.status&&(this.show("#mlt__third-party-otp #otp__third-party-error"),document.querySelector("#mlt__third-party-otp #otp__third-party-error").innerHTML=e.error)})}8==e.keyCode&&"INPUT"==r.previousSibling.nodeName&&r.previousSibling.focus()})}),document.querySelectorAll(".mlt__verify-channel").forEach(e=>{e.addEventListener("click",t=>{this.countDown.stop(),this.addLoader(),this.hide("#mlt__step-otp #otp__error"),t.target.dataset.clicked="T",document.querySelector("#mlt__step-otp #otp__error").innerHTML="",a.forEach(e=>{e.value=""}),this.tracking(t.target.dataset.channel.capitalize()+" OTP Clicked",2);var e=new FormData;e.append("domain",this.lead.domain),e.append("mobile",this.lead.mobile),e.append("name",this.lead.name),e.append("channel",t.target.dataset.channel),fetch(this.createUrl("/sms/otp-channel"),{method:"post",body:e}).then(function(e){return e.json()}).then(e=>{t.target.classList.add("hidden"),this.removeLoader(),this.startCountDown(),this.callAjaxVerification(this.lead.mobile)})})}),document.querySelector("#mlt__verify-via-missCall").addEventListener("click",e=>{this.callAjaxVerification(this.lead.mobile),this.tracking("MissCall Verification Clicked",2)}),a.forEach(i=>{i.addEventListener("keyup",e=>{var t="";this.hide("#mlt__step-otp #otp__error"),(document.querySelector("#mlt__step-otp #otp__error").innerHTML="")!=i.value&&("INPUT"==i.nextSibling.nodeName&&i.nextSibling.focus(),a.forEach(e=>{t+=e.value}),4==t.length)&&this.verifyOtp(t),8==e.keyCode&&"INPUT"==i.previousSibling.nodeName&&i.previousSibling.focus()})}),document.querySelectorAll('[data-mlt-mobile="isd"]').forEach(e=>{e.addEventListener("focus",function(){this.parentNode.querySelector(".contrycode").classList.add("active")}),e.addEventListener("blur",function(){""==this.value?this.parentNode.querySelector(".contrycode").classList.remove("active"):this.parentNode.querySelector(".contrycode").classList.add("active")}),""!=e.value&&e.parentNode.querySelector(".contrycode").classList.add("active")}),document.querySelector("#mltlead-is_whatsapp_offer").addEventListener("change",e=>{1==e.target.checked?this.tracking("Whatsapp Check",2):this.tracking("Whatsapp Uncheck",2)}),document.querySelector("#mlt__tnc-link").addEventListener("click",e=>{this.tracking("TnC Clicked",2)})}verifyOtp(e){this.addLoader(),this.tracking("Verification Submit",2);var t=new FormData;t.append("otp",e),t.append("mobile",this.lead.mobile),fetch(this.createUrl("/sms/verify-otp"),{method:"POST",body:t}).then(function(e){return e.json()}).then(e=>{this.removeLoader(),void 0!==e.mesage?(3==this.getValue("#mltlead-button_type")&&this.getWaComponent(),this.otpHide(),this.hide("#mltstep__lead .step-2, #heading__step-2"),1==this.otpScreen?this.firstStep():2==this.otpScreen&&"function"==typeof this.otpHandler&&this.otpHandler()):void 0!==e.error&&(this.show("#mlt__step-otp #otp__error"),document.querySelector("#mlt__step-otp #otp__error").innerHTML=e.error)})}setSubmit(){document.querySelectorAll("#mltstep__lead #submit__step2, #mltstep__lead #submit__overseas-step2").forEach(t=>{t.addEventListener("click",()=>{this.setValue("#mltlead-connecto_id",this.getConnectoId()),this.removeAll("#multisteps__form .error, #multisteps__overseas-form .error");var r="submit__step2"==t.getAttribute("id")?document.querySelector("#multisteps__form"):document.querySelector("#multisteps__overseas-form"),e=new FormData(r);this.addLoader(),fetch(r.getAttribute("action"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{if(this.removeLoader(),this.removeAll("#multisteps__form .error, #multisteps__overseas-form .error"),void 0!==e.errors){var t,i=e.errors;for(t in i){var a=document.createElement("span");a.classList.add("error"),a.innerHTML=i[t][0],r.querySelector("#mltlead-"+t)?r.querySelector("#mltlead-"+t.toLocaleLowerCase()).parentNode.appendChild(a):r.querySelector("#dynamicmodel-"+t)&&r.querySelector("#dynamicmodel-"+t.toLocaleLowerCase()).parentNode.appendChild(a),this.tracking("Error: "+t,2)}r.querySelector("#multisteps__form .error").scrollIntoView(!1)}else this.lead=e,this.tracking("Lead Form Submit",2),this.setLeadSubmit(e)})})})}thirdPartyOtpShow(){this.show("#mlt__third-party-otp"),this.hide("#mlt__third-party-otp #otp__third-party-error"),document.querySelector("#mlt__third-party-otp #otp__third-party-error").innerHTML="","wap"==this.getValue("#mltlead-platform")?document.querySelector("#mlt__third-party-otp .card-curved").classList.add("transition","slide-up"):this.hide("#multisteps__form, #mltstep__lead")}thirdPartyOtpHide(){this.hide("#mlt__third-party-otp"),"wap"==this.getValue("#mltlead-platform")?document.querySelector("#mlt__third-party-otp .card-curved").classList.remove("transition","slide-up"):this.show("#multisteps__form, #mltstep__lead"),this.countDown.stop()}setThirdPartyOtp(e){this.tracking("Verification Open",2),document.querySelector("#otp-third-party-message").innerHTML=e.message,this.thirdPartyOtpShow(),document.querySelectorAll('#mlt__third-party-otp input[name="otp[]"]').forEach((e,t)=>{0==t&&e.focus(),e.value=""}),this.startThirdPartyCountDown()}startThirdPartyCountDown(){document.querySelector("#otp__third-party-countDown").parentNode.classList.remove("hidden"),this.hide("#resend__third-party-otp"),this.countDown.init(document.querySelector("#otp__third-party-countDown"),()=>{document.querySelector("#otp__third-party-countDown").parentNode.classList.add("hidden"),this.show("#resend__third-party-otp")},30)}setLeadSubmit(e){void 0!==e.thirdPartyOtp&&1==e.thirdPartyOtp.status?this.setThirdPartyOtp(e.thirdPartyOtp):e.otp&&e.otp.status?this.setOtpScreen(e.otp):(3==e.button_type&&this.getWaComponent(),this.hide("#mltstep__lead .step-2, #heading__step-2"),this.firstStep()),void 0!==e.triggerAfterSave&&void 0!==e.triggerAfterSave.trigger&&"WHATSAPP_REDIRECT"===e.triggerAfterSave.trigger&&(window.location.href=e.triggerAfterSave.url),document.querySelector("#mltstep__cross-sell").innerHTML=this.lead.complete,document.querySelector("#mltstep__thanks").innerHTML=this.lead.thanks,this.executeScript("#mltstep__cross-sell"),this.lead._id&&(this.storageFactory.setName(e.name),this.storageFactory.setMobile(e.mobile),-1!==["id","ph"].indexOf(this.helper.getCountryCode()))&&"function"==typeof this.helper.savePageVisit&&this.helper.savePageVisit(this.lead._id,this.lead.name,this.lead.mobile)}setOtpScreen(t){this.tracking("Verification Open",2),document.querySelector("#otp-message").innerHTML=t.message,this.otpShow(),document.querySelectorAll('#mlt__step-otp input[name="otp[]"]').forEach((e,t)=>{0==t&&e.focus(),e.value=""}),this.startCountDown();var e=new FormData;e.append("name",this.lead.name),e.append("mobile",this.lead.mobile),e.append("channel",t.channel),e.append("domain",this.lead.domain),e.append("is_secondary_otp",t.is_secondary_otp),fetch(this.createUrl("/sms/send-otp"),{method:"post",body:e}).then(e=>e.json()).then(e=>{2==t.channel?this.callAjaxVerification(this.lead.mobile):this.autoDetectOtp()})}autoDetectOtp(){var t,e;"OTPCredential"in window&&4==(t=document.querySelectorAll('#mlt__step-otp input[name="otp[]"]')).length&&(e=new AbortController,navigator.credentials.get({otp:{transport:["sms"]},signal:e.signal}).then(e=>{let i=Array.from(String(e),e=>Number(e));t.forEach((e,t)=>{e.value=i[t]}),this.verifyOtp(e)}).catch(e=>{console.log(e)}))}stepTrigger(e,t,i){t&&void 0!==t.type?"leadformcall"==t.type?(this.tracking("Lead Form Call",3),window.location.href="tel:"+t.phone_no,i()):"form"==t.type?(document.querySelector(e).innerHTML=t.content,this.hide(".mlt-maincontainer"),this.show(e),this.addCountryCodeToMobile(".mobile-wrap"),this.setSetpSubmit("#mltstep__steps",e=>{this.tracking("Lead Form Submit",3),i()}),this.tracking("Lead Form Open",3),this.executeScript(e)):"webrtc"==t.type&&this.webRctCall(nextStep,()=>{i()}):i()}getWaComponent(){fetch(this.createUrl("/multi-step-lead/get-wa-components",{id:this.lead._id,location:this.getValue("#mltlead-leadform_location")}),{method:"GET"}).then(e=>e.json()).then(e=>{document.querySelector("#mltstep__wa-component").innerHTML=e,this.executeScript("#mltstep__wa-component")})}firstStep(){this.stepTrigger("#mltstep__steps",this.lead.firstStepForm,()=>{this.nextStep()})}addCountryCodeToMobile(e){e=document.querySelectorAll(e);e&&e.forEach(e=>{e=e.querySelector("input");e.addEventListener("focus",function(){this.parentNode.querySelector(".contrycode").classList.add("active")}),e.addEventListener("blur",function(){""==this.value?this.parentNode.querySelector(".contrycode").classList.remove("active"):this.parentNode.querySelector(".contrycode").classList.add("active")}),""!=e.value&&e.parentNode.querySelector(".contrycode").classList.add("active")})}updateStep3Info(e=""){var t=document.querySelector("#mlt-webleftbanner"),i=document.querySelector("#mlt__web-banner")?document.querySelector("#mlt__web-banner"):null;i&&e&&t?(t.setAttribute("src",e),i&&i.querySelector(".model-spec-detail")&&this.hide(".model-spec-detail")):i&&t&&(i.querySelector(".model-spec-detail")&&i.querySelector(".model-spec-detail").classList.contains("hidden")&&this.show(".model-spec-detail"),t.setAttribute("src",t.dataset.image))}nextStep(){this.updateStep3Info(void 0!==this.lead.nextStep.banner?this.lead.nextStep.banner:""),this.stepTrigger("#mltstep__steps",this.lead.nextStep,()=>{this.updateStep3Info(),this.crossSell()}),this.afterOtpTrigger(),this.trackingConfirm()}afterOtpTrigger(){fetch(this.createUrl("/multi-step-lead/after-otp-trigger",{id:this.lead._id}),{method:"GET"}).then(e=>e.json()).then(e=>{void 0!==e.trigger&&"WHATSAPP_REDIRECT"===e.trigger&&(window.location.href=e.url)})}webRctCall(r,s){document.querySelector("#mltstep__steps").innerHTML=r.callScreen,this.hide(".mlt-maincontainer"),this.show("#mltstep__steps"),setTimeout(()=>{var e=new webrtcService,i={},a=[],t=(r.dses.forEach((e,t)=>{0==t?i=e:a.push(e)}),{id:this.lead._id,index:0,vendorServiceId:r.vendorServiceId,callerName:this.lead.name,callerPhoneNumber:this.lead.mobile,dscIdentity:i.identity,dscName:i.name,dscMobile:i.mobile,event:0,otherCallee:a,callBackUrl:this.helper.getEnquiryUrl()+"/multi-step-lead/save-web-rtc?countryCode="+this.helper.getCountryCode(),source:"lead",pageRefreshCode:"OTO_001",noOfTryCall:0,afterSaveLog:()=>{document.querySelector("#lead-section").removeAttribute("style"),"function"==typeof s&&s()},tracking:e=>{this.tracking(e,3)}});"undefined"!=typeof nativeInterface?e.createToken(t):e.initInfobipCall(t)},100),document.querySelector("#lead-section").style.padding="0px"}crossSell(){if(""==this.lead.complete)return this.finished(),!1;this.hide(".mlt-maincontainer"),this.show("#mltstep__cross-sell"),this.tracking("Lead Form Open",4),setTimeout(()=>{document.querySelectorAll(".step-thanks .similar-cars > ul > li").forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")?(e.classList.remove("active"),this.tracking("CrossSell Uncheck",4)):(e.classList.add("active"),this.tracking("CrossSell Checked",4)),this.showHideSubmitCS()})});var e=document.querySelectorAll(".step-thanks .best-offers ul > li");0<e.length&&this.tracking("Offer Appear",4),e.forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")?(e.classList.remove("active"),this.tracking("Offer Uncheck",4)):(e.classList.add("active"),this.tracking("Offer Checked",4)),this.showHideSubmitCS()})}),document.querySelectorAll('#mlt__finance-opt input[type="radio"], #mlt__insurance-opt input[type="radio"], #mlt__testdrive-opt input[type="radio"]').forEach(e=>{e.addEventListener("click",()=>{"Yes"==e.value?this.tracking(e.getAttribute("name")+" Checked",4):this.tracking(e.getAttribute("name")+" Uncheck",4),this.showHideSubmitCS()})}),document.querySelector("#submit__cross-sell > button")&&this.setCrossSellSubmit(),this.setConditional(document.querySelector("#mltstep__cross-sell")),document.querySelectorAll("#mltstep__cross-sell .mlt__custom-form-opt form").forEach(e=>{this.tracking("Form open",e.dataset.name),this.formFieldEvent("mltstep__cross-sell",4)})},100)}showHideSubmitCS(){var e=document.querySelector("#submit__cross-sell"),t=e.querySelector("button"),i=document.querySelectorAll(".step-thanks .similar-cars > ul > li.active").length,a=document.querySelectorAll(".step-thanks .best-offers ul > li.active").length,r=document.querySelectorAll(".step-thanks .mlt__custom-form-opt").length,s=0;document.querySelectorAll('#mlt__finance-opt input[type="radio"]:checked, #mlt__insurance-opt input[type="radio"]:checked, #mlt__testdrive-opt input[type="radio"]:checked').forEach(e=>{"Yes"==e.value&&s++}),"YES"==t.getAttribute("data-skip-cross-sell")||i||a||s||r?(t.classList.remove("btn-disble"),t.removeAttribute("disabled")):e&&(t.classList.add("btn-disble"),t.setAttribute("disabled","disabled"))}setCrossSellSubmit(){this.showHideSubmitCS(),document.querySelector("#submit__cross-sell > button").addEventListener("click",e=>{var i=document.querySelectorAll(".step-thanks .similar-cars > ul > li.active"),a=document.querySelectorAll(".step-thanks .best-offers ul > li.active"),r=new FormData;r.append("leadId",this.lead._id),i.forEach((e,t)=>{r.append("cs["+t+"][brand]",e.querySelector('input[name="brand"]').value),r.append("cs["+t+"][brand_slug]",e.querySelector('input[name="brand_slug"]').value),r.append("cs["+t+"][model]",e.querySelector('input[name="model"]').value),r.append("cs["+t+"][model_slug]",e.querySelector('input[name="model_slug"]').value)}),a.forEach((e,t)=>{r.append("offers["+t+"][dse_id]",e.querySelector('input[name="dse_id"]').value),r.append("offers["+t+"][outlet_id]",e.querySelector('input[name="outlet_id"]').value),r.append("offers["+t+"][packet_id]",e.querySelector('input[name="packet_id"]').value),r.append("offers["+t+"][ld_pack_id]",e.querySelector('input[name="ld_pack_id"]').value),r.append("offers["+t+"][offer_title]",e.querySelector('input[name="offer_title"]').value),r.append("offers["+t+"][down_payment]",e.querySelector('input[name="down_payment"]').value),r.append("offers["+t+"][emi]",e.querySelector('input[name="emi"]').value),r.append("offers["+t+"][tenure]",e.querySelector('input[name="tenure"]').value),r.append("offers["+t+"][discount]",e.querySelector('input[name="discount"]').value),r.append("offers["+t+"][finance_company]",e.querySelector('input[name="finance_company"]').value),r.append("offers["+t+"][variant_slug]",e.querySelector('input[name="variant_slug"]').value),r.append("offers["+t+"][variant_id]",e.querySelector('input[name="variant_id"]').value)}),this.additionalForms(t=>{this.addLoader(),fetch(e.target.dataset.url,{method:"POST",body:r,credentials:"include"}).then(e=>e.json()).then(e=>{this.removeLoader(),this.tracking("Lead Form Submit",4),void 0!==e.crossSell&&!1!==e.crossSell.otp?(this.otpScreen=2,this.hide("#edit-mobile"),this.otpHandler=()=>{i.forEach(e=>{e.remove()}),a.forEach(e=>{e.remove()}),document.querySelector("#submit__cross-sell").classList.add("hidden"),t()},this.lead.otp=e.crossSell.otp,this.setOtpScreen(e.crossSell.otp)):t()})})})}async additionalForms(e){var r=[],s=!0,t=document.querySelectorAll("#mltstep__cross-sell input[data-mltlead]"),i=document.querySelectorAll("#mltstep__cross-sell .mlt__custom-form-opt");t.forEach(e=>{""!=e.value&&r.push({id:e.value,name:e.getAttribute("name"),type:e.getAttribute("data-mltlead"),position:e.getAttribute("data-mltposition"),status:!1,data:[]})});for(let a of i)await fetch(a.querySelector("form").getAttribute("action"),{method:"POST",body:new FormData(a.querySelector("form")),credentials:"include"}).then(e=>e.json()).then(e=>{if(this.removeAll(a.querySelectorAll(".error")),void 0!==e.error)for(var t in s=!1,e.error){var i=document.createElement("span");i.classList.add("error"),i.innerHTML=e.error[t][0],a.querySelector("#dynamicmodel-"+t.toLocaleLowerCase()).parentNode.appendChild(i)}else void 0!==e.type&&r.push({id:this.lead._id,name:a.querySelector("form").getAttribute("id"),type:5,position:a.getAttribute("data-mltposition"),status:!1,data:e});void 0===e.error&&this.tracking("Form submit",a.querySelector("form").dataset.name)});if(!s)return(i=(t=document.querySelector("#mltstep__cross-sell")).querySelector("span.error"))&&"web"!=this.lead.platform?window.scrollTo({top:t.querySelector("span.error").offsetTop-100,behavior:"smooth"}):i&&t.scrollTo({top:t.querySelector("span.error").offsetTop-100,behavior:"smooth"}),!1;"function"==typeof e&&e(()=>{r.sort(function(e,t){return e.position<t.position?-1:t.position<e.position?1:0}),0<r.length?this.openAdditionalForms(r):this.finished()})}openAdditionalForms(i){var e,a=!1;if(i.forEach((e,t)=>{0==a&&0==e.status&&(a=e,i[t].status=!0)}),0==a)return this.finished(),!1;void 0!==a.data.type?this.setAdditionalForm(a.data,i):(this.addLoader(),(e=new FormData).append("id",a.id),e.append("type",a.type),fetch(this.helper.getEnquiryUrl()+"/multi-step-lead/additional-form?countryCode="+this.helper.getCountryCode()+"&lang_code="+this.helper.getLangCode(),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{this.removeLoader(),this.setAdditionalForm(e,i)}))}setAdditionalForm(e,t){void 0!==e.type?(document.querySelector("#mltstep__additional-form").innerHTML=e.content,this.hide(".mlt-maincontainer"),this.show("#mltstep__additional-form"),this.executeScript("#mltstep__additional-form"),this.setSetpSubmit("#mltstep__additional-form",e=>{this.openAdditionalForms(t)})):this.openAdditionalForms(t)}setSetpSubmit(r,s){setTimeout(()=>{this.setConditional(document.querySelector(r)),document.querySelector(r+" form").addEventListener("keypress",e=>{if(13===(e.keyCode||e.which))return e.preventDefault(),!1});var e=document.querySelectorAll(r+" .mlt-form-submit");e[e.length-1].addEventListener("click",e=>{var a=e.target.parentNode.parentNode,e=new FormData(a);this.addLoader(),fetch(a.getAttribute("action"),{method:"POST",body:e,credentials:"include"}).then(e=>e.json()).then(e=>{if(this.removeLoader(),this.removeAll(a.querySelectorAll(".error")),void 0===e.error&&this.tracking("Form submit",document.querySelector(r+" form").dataset.name),void 0!==e.error){for(var t in e.error){var i=document.createElement("span");i.classList.add("error"),i.innerHTML=e.error[t][0],a.querySelector("#dynamicmodel-"+t.toLocaleLowerCase()).parentNode.appendChild(i)}a.querySelector("#dynamic-form .error").scrollIntoView(!1),window.scrollBy(0,100)}else void 0!==e.type&&"form"==e.type?(document.querySelector(r).innerHTML=e.content,this.hide(".mlt-maincontainer"),this.show(r),this.executeScript(r),this.setSetpSubmit(r,s),this.updateStep3Info(void 0!==e.banner?e.banner:"")):void 0!==e.trigger&&"webrtc"==e.trigger?this.webRctCall(e,()=>{s(e)}):void 0!==e.trigger&&"907DCB"==e.trigger?(this.lead._id=e._id,s(e)):"function"==typeof s&&(void 0!==e.trigger&&"directcall"==e.trigger&&("web"==this.lead.platform?alert(e.message):window.location.href="tel:"+e.phone_no),document.querySelector("#mlt-webleftbanner")&&document.querySelector("#mlt-webleftbanner").setAttribute("src",document.querySelector("#mlt-webleftbanner").getAttribute("data-image")),"function"==typeof s)&&s(e)})}),this.formFieldEvent(r,"#mltstep__additional-form"==r?6:3),this.tracking("Form open",document.querySelector(r+" form").dataset.name)},50)}formFieldEvent(e,a){document.querySelectorAll(e+' input[type="text"], '+e+" textarea, "+e+' input[type="tel"]').forEach(i=>{i.addEventListener("blur",e=>{var t;""!=i.value&&i.getAttribute("name").includes("DynamicModel")&&(t=i.getAttribute("name").replace("DynamicModel[","").replace("]",""),this.tracking(t+"  Filled",a))})}),document.querySelectorAll(e+' input[type="checkbox"], '+e+' input[type="radio"], '+e+" select").forEach(i=>{i.addEventListener("change",e=>{var t;""!=i.value&&i.getAttribute("name").includes("DynamicModel")&&(t=i.getAttribute("name").replace("DynamicModel[","").replace("]",""),this.tracking(t+" - "+i.value+" Selected",a))})})}getDateRange(e){var t,i,a,r,s=new Date(2050,12,31),o=new Date(1940,1,1);""!=e.dataset.customvalidate&&((t=e.dataset.customvalidate.split(",")).includes("DobDateValidator")&&((i=new Date).setFullYear(i.getFullYear()-18),s=new Date(i.getFullYear(),i.getMonth(),i.getDate())),t.includes("PastDateValidator")&&((i=new Date).setFullYear(i.getFullYear()),s=new Date(i.getFullYear(),i.getMonth(),i.getDate())),t.includes("FutureDateValidator"))&&((i=new Date).setFullYear(i.getFullYear()),o=new Date(i.getFullYear(),i.getMonth(),i.getDate()));try{""!=e.dataset.mindate&&(a=e.dataset.mindate.split("-"),o=new Date(a[0],a[1]-1,a[2])),""!=e.dataset.maxdate&&(r=e.dataset.maxdate.split("-"),s=new Date(r[0],r[1]-1,r[2]))}catch(e){console.log(e.message)}return{minDate:o,maxDate:s}}datepicker(e){"undefined"!=typeof $&&"function"==typeof $().datepicker?document.querySelectorAll(e+' [data-datetime="datetime"]').forEach(e=>{var t=this.getDateRange(e);$(e).datepicker({dateFormat:e.dataset.format,autoclose:!0,changeYear:!0,changeMonth:!0,maxDate:t.maxDate,minDate:t.minDate,yearRange:"1940:2050"}).attr("readonly",!0)}):setTimeout(()=>{this.datepicker(e)},3e3),document.querySelectorAll(e+" [data-daypicker]").forEach(e=>{var t=new Date,i=this.getDateRange(e.querySelector("[data-customvalidate]")),a=i.minDate.getFullYear(),r=i.maxDate.getFullYear(),s=e.querySelector('[data-daytype="year"]').innerHTML;if(a>=t.getFullYear())for(var o=a;o<=r;o++)s+=`<option value="${o}">${o}</option>`;else for(o=r;a<=o;o--)s+=`<option value="${o}">${o}</option>`;e.querySelector('[data-daytype="year"]').innerHTML=s,new CustomSelect("[data-daypicker] .custom-select"),this.updateDayList(e)})}updateDayList(n){n.querySelectorAll('[data-daytype="year"], [data-daytype="month"]').forEach(e=>{e.addEventListener("change",e=>{var t=n.querySelector('[data-daytype="year"]').value,i=n.querySelector('[data-daytype="month"]').value,a=n.querySelector('[data-daytype="day"]').value,r=30,s='<option value="">'+n.querySelector('[data-daytype="day"]').querySelector("option").text+"</option>",o="";n.querySelector('[data-daytype="day"]').nextSibling.innerHTML=n.querySelector('[data-daytype="day"]').querySelector("option").text,""!=i&&["01","03","05","7","8","10","12"].includes(i)?r=31:2==i&&(r=28,""!=t)&&t%4==0&&(r=29);for(var l=1;l<=r;l++)o="",a==l&&(o='selected="selected"',n.querySelector('[data-daytype="day"]').nextSibling.innerHTML=l),s+=`<option ${o} value="`+("0"+l).slice(-2)+`">${l}</option>`;n.querySelector('[data-daytype="day"]').innerHTML=s,new CustomSelect("[data-daypicker] .custom-select")})}),n.querySelectorAll('[data-daytype="year"], [data-daytype="month"], [data-daytype="day"]').forEach(e=>{e.addEventListener("change",e=>{var t=n.querySelector('[data-daytype="year"]').value,i=n.querySelector('[data-daytype="month"]').value,a=n.querySelector('[data-daytype="day"]').value;n.querySelector('[type="hidden"]').value=t&&i&&a?t+`-${i}-`+a:""})})}setConditional(e){var i={};let r=["click","change"];new CustomSelect("#"+e.getAttribute("id")+" .custom-select"),this.autoTextarea("#"+e.getAttribute("id")+" textarea"),this.setRefreshOn("#"+e.getAttribute("id")),e.querySelectorAll("[data-conditional]").forEach(e=>{var t=e.dataset.condwhen;void 0===i[t]&&(i[t]=[]),i[t].push({id:e.getAttribute("id"),show:e.dataset.condshow,when:e.dataset.condwhen,eq:e.dataset.condeq})});for(let[a,t]of Object.entries(i))t.forEach(e=>{"1"===e.show&&this.hideFieldset(document.getElementById(e.id),!0)}),e.querySelectorAll('input[data-key="'+a+'"], select[data-key="'+a+'"]').forEach(i=>{r.forEach(e=>{i.addEventListener(e,e=>{t.forEach(e=>{var t=i.value;"radio"==i.getAttribute("type")&&(t=document.querySelector('[data-key="'+a+'"]:checked')?document.querySelector('[data-key="'+a+'"]:checked').value:""),e.eq==t&&"1"===e.show?this.showFieldset(document.getElementById(e.id)):e.eq==t&&"0"===e.show&&this.hideFieldset(document.getElementById(e.id),!0),e.eq!=t&&"1"===e.show?this.hideFieldset(document.getElementById(e.id),!0):e.eq!=t&&"0"===e.show&&this.showFieldset(document.getElementById(e.id))})}),setTimeout(()=>{this.gtmTracking=!1,i.dispatchEvent(new Event(e)),this.gtmTracking=!0},20)})});this.datepicker("#"+e.getAttribute("id"))}setRefreshOn(l){document.querySelectorAll(l+" [data-refreshon]").forEach(o=>{document.querySelector('[data-key="'+o.dataset.refreshon+'"]').addEventListener("change",e=>{var t,i=o.dataset.url,a=document.querySelector(l+" form"),r=this.serialize(a);for(t in r){var s=t.replace("DynamicModel","").replace("[","").replace("]",""),i=i.replace("{{row."+s+"}}",r[t]),s=t.replace("MltLead","").replace("[","").replace("]","");i=(i=(i=i.replace("{{lead."+s+"}}",r[t])).replace("{{langCode}}",this.helper.getLangCode())).replace("{{businessUnit}}",this.businessUnit)}fetch(i,{method:"GET",credentials:"include"}).then(e=>e.json()).then(e=>{var t=e[o.dataset.index]||e,i="";if(0<t.length){for(var a in i='<option value="">'+o.querySelector("option").innerHTML+"</option>",t){var r,s=o.dataset.template;for(r in s=(s=s.split("\\")).join(""),t[a])s=s.replace("{{item."+r+"}}",t[a][r]);i+=s}"city"==o.dataset.refreshon&&(o.parentNode.classList.add("transition"),o.parentNode.classList.remove("hidden"))}else"city"==o.dataset.refreshon&&(o.parentNode.classList.add("hidden"),o.parentNode.classList.remove("transition"),i+='<option selected="selected" value="NA">NA</option>');o.innerHTML=i,new CustomSelect(l+" .field-"+o.getAttribute("id"))}),o.parentNode.querySelector(".select-selected").innerHTML=o.parentNode.querySelector(".select-items > div").innerHTML},{once:!0,passive:!0,capture:!0})})}showFieldset(e){"fieldset"==e.tagName.toLowerCase()?(e.classList.remove("hidden"),e.querySelectorAll("input, select, textarea").forEach(e=>{e.removeAttribute("disabled","disabled")})):this.showFieldset(e.parentNode),e.querySelectorAll("input, select").forEach(e=>{e.dispatchEvent(new Event("click"))})}hideFieldset(e,t){"fieldset"==e.tagName.toLowerCase()?(e.classList.add("hidden"),1==t&&e.querySelectorAll("input, select, textarea").forEach(e=>{e.setAttribute("disabled","disabled")})):this.hideFieldset(e.parentNode,t),e.hasAttribute("data-key")&&setTimeout(()=>{document.querySelectorAll('[data-condwhen="'+e.getAttribute("data-key")+'"]').forEach(e=>{this.hideFieldset(e,t)})},20)}finished(){this.hide(".mlt-maincontainer"),this.show("#mltstep__thanks"),this.tracking("Lead Form Open",5),"wap"==this.getValue("#mltlead-platform")&&window.scrollTo({top:0}),setTimeout(()=>{this.executeScript("#mltstep__thanks")},10)}executeScript(query){var scripts=document.querySelector(query).querySelectorAll("script");scripts.forEach(script=>{var tag;""!=script.src?(tag=document.createElement("script"),tag.src=script.src,document.querySelector("head").appendChild(tag)):eval(script.innerHTML)})}serialize(e){if(e&&"FORM"===e.nodeName){for(var t,i=[],a=e.elements.length-1;0<=a;a-=1)if(""!==e.elements[a].name)switch(e.elements[a].nodeName){case"INPUT":switch(e.elements[a].type){case"text":case"tel":case"email":case"hidden":case"password":case"button":case"reset":case"submit":i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].value));break;case"checkbox":case"radio":e.elements[a].checked&&i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].value))}break;case"file":break;case"TEXTAREA":i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].value));break;case"SELECT":switch(e.elements[a].type){case"select-one":i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].value));break;case"select-multiple":for(t=e.elements[a].options.length-1;0<=t;t-=1)e.elements[a].options[t].selected&&i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].options[t].value))}break;case"BUTTON":switch(e.elements[a].type){case"reset":case"submit":case"button":i.push(e.elements[a].name+"="+encodeURIComponent(e.elements[a].value))}}return JSON.parse('{"'+i.join("&").replace(/&/g,'","').replace(/=/g,'":"')+'"}',function(e,t){return""===e?t:decodeURIComponent(t)})}}}